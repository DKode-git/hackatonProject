<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINETIC // Logger V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #121214;
            --surface: #1C1C1E;
            --primary-blue: #00D1FF;
            --accent-lime: #C1FF72;
        }
        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Inter', sans-serif;
            padding-bottom: 120px; 
            overflow-x: hidden;
        }
        .font-timer { font-family: 'Montserrat', sans-serif; font-feature-settings: "tnum"; }
        
        /* Physics & Interaction */
        .hover-spring { transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .hover-spring:active { transform: scale(0.92); }
        
        .glass-panel { background: rgba(28, 28, 30, 0.8); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.08); }
        
        .input-dark {
            background: #2C2C2E;
            color: white;
            border: 1px solid transparent;
            text-align: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        .input-dark:focus { outline: none; border-color: var(--primary-blue); background: #3A3A3C; }

        /* Row Logic */
        .set-row { transition: background-color 0.3s ease, color 0.3s ease; border-radius: 8px; }
        .set-row.completed { background-color: var(--accent-lime); color: black; }
        .set-row.completed input { background-color: rgba(255,255,255,0.3); color: black; font-weight: 800; }
        .set-row.completed .check-box { background: black; border-color: black; }
        .set-row.completed .check-box i { transform: scale(1); }

        .check-box {
            width: 28px; height: 28px;
            border: 2px solid #555; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .check-box i { transform: scale(0); transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); color: var(--accent-lime); }

        /* Animations */
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .entry-anim { animation: slideUp 0.5s ease-out forwards; }
        
        /* Views */
        #view-tracker { display: none; }
    </style>
</head>
<body class="min-h-screen relative">

    <section id="view-start" class="h-screen flex flex-col items-center justify-center p-6 text-center z-50 bg-[#121214]">
        <div class="mb-8 p-6 rounded-full bg-[#1C1C1E] border border-white/5 shadow-[0_0_40px_rgba(0,209,255,0.1)]">
            <i class="fa-solid fa-bolt text-6xl text-[#00D1FF]"></i>
        </div>
        <h1 class="text-4xl font-black font-timer mb-2">READY?</h1>
        <p class="text-white/40 mb-12">System primed. Tracking metrics standing by.</p>
        <button onclick="startSession()" class="w-full max-w-xs bg-[#00D1FF] text-black font-black py-5 rounded-2xl text-xl tracking-wider hover-spring shadow-[0_0_30px_rgba(0,209,255,0.4)]">
            INITIATE SESSION
        </button>
    </section>

    <div id="view-tracker">
        <header class="sticky top-0 z-40 bg-[#121214]/95 backdrop-blur-md pt-6 pb-4 px-6 border-b border-white/5 shadow-2xl">
            <div class="flex justify-between items-center mb-1">
                <span class="text-[10px] font-bold tracking-[0.2em] text-white/40 uppercase">Session Active</span>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-[#00D1FF] animate-pulse"></span>
                    <span class="text-[#00D1FF] text-xs font-bold">REC</span>
                </div>
            </div>
            <div id="timer-display" class="font-timer text-6xl font-black text-[#00D1FF] tracking-tighter leading-none">
                00:00:00
            </div>
        </header>

        <main id="workout-container" class="p-4 space-y-6">
            <div id="empty-state" class="text-center py-10 opacity-30">
                <p class="italic">No exercises added yet.</p>
                <p class="text-xs mt-2">Tap + to begin.</p>
            </div>
        </main>

        <div class="h-32"></div>
    </div>

    <div id="fab-container" class="fixed bottom-28 right-6 z-40 hidden">
        <button onclick="toggleOverlay()" class="w-16 h-16 rounded-full bg-[#2C2C2E] border border-white/10 shadow-2xl text-white hover:bg-[#00D1FF] hover:text-black hover:scale-110 hover-spring transition-all flex items-center justify-center text-2xl">
            <i class="fa-solid fa-plus"></i>
        </button>
    </div>

    <div id="footer-action" class="fixed bottom-0 left-0 w-full glass-panel p-6 z-50 hidden">
        <button onclick="finishSession()" class="w-full bg-[#1C1C1E] border border-white/10 hover:bg-[#C1FF72] hover:text-black hover:border-[#C1FF72] text-white font-bold py-4 rounded-xl text-lg tracking-wider hover-spring transition-all">
            FINISH & SYNC
        </button>
    </div>

    <div id="overlay" class="fixed inset-0 bg-black/95 backdrop-blur-xl z-[60] hidden flex flex-col justify-end">
        <div class="p-6 bg-[#1C1C1E] rounded-t-3xl border-t border-white/10 pb-10 entry-anim">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">New Exercise</h2>
                <button onclick="toggleOverlay()" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white/50"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <label class="text-xs font-bold text-[#00D1FF] uppercase tracking-widest mb-2 block">Movement Name</label>
            <input type="text" id="new-exercise-name" placeholder="e.g. Incline Bench Press" class="w-full bg-[#121214] p-4 rounded-xl text-xl text-white border border-white/10 focus:border-[#00D1FF] focus:outline-none mb-6">
            
            <button onclick="addNewExerciseCard()" class="w-full bg-[#00D1FF] text-black font-bold py-4 rounded-xl text-lg hover-spring">
                ADD TO WORKOUT
            </button>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        const APP = {
            active: false,
            timer: null,
            seconds: 0,
            exercises: [] // Stores IDs to manage data
        };

        // --- SESSION LOGIC ---
        function startSession() {
            APP.active = true;
            
            // UI Switch
            document.getElementById('view-start').style.display = 'none';
            document.getElementById('view-tracker').style.display = 'block';
            document.getElementById('fab-container').style.display = 'block';
            document.getElementById('footer-action').style.display = 'block';

            // Start Timer
            APP.timer = setInterval(() => {
                APP.seconds++;
                const date = new Date(0);
                date.setSeconds(APP.seconds);
                const timeString = date.toISOString().substr(11, 8);
                document.getElementById('timer-display').innerText = timeString;
            }, 1000);
        }

        // --- EXERCISE CARD LOGIC ---
        
        function toggleOverlay() {
            const overlay = document.getElementById('overlay');
            const input = document.getElementById('new-exercise-name');
            
            if (overlay.classList.contains('hidden')) {
                overlay.classList.remove('hidden');
                input.value = '';
                input.focus();
            } else {
                overlay.classList.add('hidden');
            }
        }

        function addNewExerciseCard() {
            const nameInput = document.getElementById('new-exercise-name');
            const name = nameInput.value.trim();
            if (!name) return; // Validation

            const exerciseId = 'ex-' + Date.now();
            APP.exercises.push({ id: exerciseId, name: name });

            const container = document.getElementById('workout-container');
            const emptyState = document.getElementById('empty-state');
            if(emptyState) emptyState.style.display = 'none';

            // Create Card HTML
            const card = document.createElement('div');
            card.id = exerciseId;
            card.className = "bg-[#1C1C1E] rounded-2xl p-5 shadow-lg border border-white/5 entry-anim";
            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-xl font-bold tracking-tight text-white">${name}</h2>
                    <button class="text-white/20 hover:text-white"><i class="fa-solid fa-ellipsis"></i></button>
                </div>
                
                <div class="grid grid-cols-10 gap-2 mb-3 text-[10px] font-bold text-white/30 uppercase tracking-wider text-center">
                    <div class="col-span-1">Set</div>
                    <div class="col-span-3">KG</div>
                    <div class="col-span-3">Reps</div>
                    <div class="col-span-3">Done</div>
                </div>

                <div class="space-y-2 sets-container" id="${exerciseId}-sets">
                    </div>
                
                <button onclick="addSet('${exerciseId}')" class="w-full mt-4 py-3 rounded-xl border border-dashed border-white/10 text-white/30 text-sm font-bold hover:bg-white/5 hover:text-white transition-all">
                    + ADD SET
                </button>
            `;

            container.appendChild(card);
            
            // Auto-add first set
            addSet(exerciseId);
            
            toggleOverlay();
        }

        function addSet(exerciseId) {
            const container = document.getElementById(`${exerciseId}-sets`);
            const currentSets = container.children.length;
            const setNumber = currentSets + 1;
            const rowId = `${exerciseId}-set-${setNumber}`;

            // Try to find previous values to copy (Quality of Life)
            let prevKg = '';
            let prevReps = '';
            if (currentSets > 0) {
                const prevRow = container.children[currentSets - 1];
                prevKg = prevRow.querySelector('.input-kg').value;
                prevReps = prevRow.querySelector('.input-reps').value;
            }

            const row = document.createElement('div');
            row.className = "grid grid-cols-10 gap-2 items-center p-2 set-row bg-[#121214]/50 border border-white/5";
            row.id = rowId;
            row.innerHTML = `
                <div class="col-span-1 text-center font-mono text-sm opacity-50">${setNumber}</div>
                <div class="col-span-3">
                    <input type="number" class="input-kg w-full py-2 input-dark text-lg font-bold" value="${prevKg}" placeholder="-">
                </div>
                <div class="col-span-3">
                    <input type="number" class="input-reps w-full py-2 input-dark text-lg font-bold" value="${prevReps}" placeholder="-">
                </div>
                <div class="col-span-3 flex justify-center">
                    <div class="check-box hover-spring bg-[#2C2C2E]" onclick="toggleSet('${rowId}')">
                        <i class="fa-solid fa-check text-xs"></i>
                    </div>
                </div>
            `;
            
            container.appendChild(row);
        }

        function toggleSet(rowId) {
            const row = document.getElementById(rowId);
            const inputs = row.querySelectorAll('input');
            const isComplete = row.classList.contains('completed');

            if (!isComplete) {
                row.classList.add('completed');
                inputs.forEach(i => i.disabled = true);
            } else {
                row.classList.remove('completed');
                inputs.forEach(i => i.disabled = false);
            }
        }

        // --- BACKEND HANDOFF ---
        async function finishSession() {
            // Scrape data from DOM
            const btn = document.querySelector('#footer-action button');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> SYNCING...';
            
            const payload = {
                duration: APP.seconds,
                exercises: []
            };

            // Iterate through our tracked exercise IDs
            APP.exercises.forEach(ex => {
                const setRows = document.querySelectorAll(`#${ex.id}-sets .set-row`);
                const setsData = [];
                
                setRows.forEach(row => {
                    const kg = row.querySelector('.input-kg').value;
                    const reps = row.querySelector('.input-reps').value;
                    const completed = row.classList.contains('completed');
                    
                    if(kg || reps) { // Only save if data exists
                        setsData.push({ kg, reps, completed });
                    }
                });

                if (setsData.length > 0) {
                    payload.exercises.push({
                        name: ex.name,
                        sets: setsData
                    });
                }
            });

            console.log("Payload ready:", payload);

            // Simulation of Backend Call
            const API_URL = "https://your-render-app.onrender.com/api/v1/workout/save";
            
            try {
                // In real usage, uncomment this:
                // await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                
                setTimeout(() => {
                    btn.className = "w-full bg-[#C1FF72] text-black font-bold py-4 rounded-xl text-lg tracking-wider";
                    btn.innerHTML = '<i class="fa-solid fa-check"></i> SAVED';
                }, 1000);
            } catch (e) {
                alert("Sync error - check console");
            }
        }
    </script>
</body>
</html>